CREATE TABLE IF NOT EXISTS users (id VARCHAR(50) PRIMARY KEY, "name" VARCHAR(255) NOT NULL, email VARCHAR(255) NOT NULL, "password" VARCHAR(255) NOT NULL, activated BOOLEAN DEFAULT FALSE NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL);
ALTER TABLE users ADD CONSTRAINT users_email_unique UNIQUE (email);
CREATE TABLE IF NOT EXISTS recipes (id VARCHAR(255) PRIMARY KEY, "name" VARCHAR(255) NOT NULL, description TEXT NOT NULL, image_path VARCHAR(512) NULL, instructions TEXT NOT NULL, author_id VARCHAR(255) NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, CONSTRAINT fk_recipes_author_id__id FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT);
CREATE TABLE IF NOT EXISTS ingredients (id VARCHAR(100) PRIMARY KEY, recipe_id VARCHAR(255) NOT NULL, "name" VARCHAR(255) NOT NULL, quantity REAL NOT NULL, unit VARCHAR(20) NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, is_deleted BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT fk_ingredients_recipe_id__id FOREIGN KEY (recipe_id) REFERENCES recipes(id) ON DELETE CASCADE ON UPDATE RESTRICT);
CREATE INDEX ingredients_recipe_id ON ingredients (recipe_id);
ALTER TABLE ingredients ADD CONSTRAINT idx_recipe_ingredient_unique UNIQUE (recipe_id, "name");
CREATE TABLE IF NOT EXISTS recipe_likes (id SERIAL PRIMARY KEY, user_id VARCHAR(255) NOT NULL, recipe_id VARCHAR(255) NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, CONSTRAINT fk_recipe_likes_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT, CONSTRAINT fk_recipe_likes_recipe_id__id FOREIGN KEY (recipe_id) REFERENCES recipes(id) ON DELETE CASCADE ON UPDATE RESTRICT);
CREATE TABLE IF NOT EXISTS recipe_comments (id VARCHAR(255) PRIMARY KEY, recipe_id VARCHAR(255) NOT NULL, author_id VARCHAR(255) NOT NULL, "content" TEXT NOT NULL, created_at TIMESTAMP NOT NULL, CONSTRAINT fk_recipe_comments_recipe_id__id FOREIGN KEY (recipe_id) REFERENCES recipes(id) ON DELETE CASCADE ON UPDATE RESTRICT, CONSTRAINT fk_recipe_comments_author_id__id FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT);
